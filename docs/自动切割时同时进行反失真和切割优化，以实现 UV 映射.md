# 自动切割时同时进行反失真和切割优化，以实现 UV 映射
> 作者：
ROI PORANNE, ETH Zurich
MARCO TARINI, CNR-ISTI and Univ. Insubria
SANDRO HUBER, ETH Zurich
DANIELE PANOZZO, New York University
OLGA SORKINE-HORNUNG, ETH Zurich

![封面](./illustration/cover.png)
```
图 1. 我们的方法生成高质量的 UV 贴图，平衡接缝数量和贴图的扭曲。该方法以交互速率运行，并且
如果需要，可以为美工人员提供对 UV 贴图的完全控制权。我们提供交互式工具，例如用于打包岛的边界框（左）、绘制
吸引或阻止接缝创建的区域，以及半自动删除重叠区域。每个工具都提供交互式反馈，效果显著
简化复杂 UV 贴图的设计。
```

## 前言

我们提出了一个UV映射算法，联合优化的切割和失真，避免了启发式放置切割。我们最小化的能量是一种最先进的几何失真度量，推广到考虑接缝。我们的算法旨在支持一个交互式工作流：它动态优化UV地图，而用户可以交互式移动顶点，切割网格部分，连接接缝，单独的重叠区域，并控制参数化补丁在UV空间中的位置。我们的UV贴图在几何失真和切割放置方面都是高质量的，并优于那些设计的传统建模工具。与现有方法一样，我们的紫外线映射可以在一小部分时间内创建，因为我们的算法大大减轻了困扰传统UV映射方法的试错迭代过程。

## 1. 介绍
UV图在计算机图形学中被广泛使用，用于将定期采样的二维数据，如颜色、法线或位移，映射到嵌入在3D中的表面上。在过去的三十年里，UV图的设计受到了研究界的广泛关注。它传统上分为两个步骤：最优切割的计算，也称为接缝，以及尽量减少结果补丁被映射到平面上时的失真。这两个子问题在本质上是非常不同的：前者是离散的和组合的，因为切割是从一个离散的网格体边集中选择的，而后者是连续的，因为扭曲取决于网格顶点的UV坐标。切割通常首先计算，并严重影响结果参数化的质量；如果UV映射的质量不足以满足预期的应用程序，用户必须改变切割并重新运行参数化计算机，可能会重复这个试错循环几次。切割通常首先计算，并严重影响结果参数化的质量；如果UV映射的质量不足以满足预期的需求，用户必须改变切割并重新运行参数化计算机, 可能会重复试错几次。

我们提出了第一种方法来共同优化切割和几何失真。我们的算法最小化最先进的失真措施在交互速率，同时识别一组足够的网格边缘来切割。虽然以前的方法优化了切割或失真单独，我们的公式自动引入切割，并在同一能量优化过程中最小化失真。我们的算法的关键思想是通过单独参数化每个三角形来建模UV映射，使用吸引能量来鼓励参数化在匹配的边对上是连续的。吸引能量上的稀疏性诱导范数只导致少数边缘对不合并，而这些是最终的UV图的接缝。直观地说，这对应于经典的接缝二进制概念的松弛：在优化过程中，我们不是将每条边标记为接缝或正则边，而是允许它介于两者之间。随着算法的收敛，这些边缘会越来越接近接缝边或规则边，直到它们足够接近，可以被“捕捉”到两个选项中的一个。

虽然我们的算法已经在自动模式下有用，它的优势是支持数字艺术家首选的交互式工作流：我们的优化运行在后台，而用户可以交互移动顶点，切割网格部分，连接接缝，删除自我重叠区域和包装产生的补丁在紫外线空间（见图1和伴随的视频）。所有这些约束都可以是困难的，覆盖了我们的算法所支持的能量最小化决策，也可以是软的，引导优化朝着所需的方向发展。

我们希望我们的算法会影响UV图的设计，因为它消除了目前常见的令人沮丧的试错工作流。此外，它还提供了一个交互式界面，使艺术家能够手动指定地图的语义相关部分，同时在后台自动处理剩余的优化。我们提供了我们的方法的参考和开源实现（见第4节），以确保我们的结果的可复制性，并鼓励集成到现有的工具中。

## 2. 相关工作
曲面参数化，即UV图构造，在文献中被广泛涵盖[Hormann等人，2007；Sheffer等人，2006]。计算切割和最小化失真的子问题已经被广泛的研究——然而，大多是分开的。

2.1 最小化失真
大部分应用要求参数化映射尽可能地保持等距，即尽可能多地保持角度和面积。大量的失真的措施已经被提出来量化一个给定的映射和等距之间的差异。所选择的失真测量通常是通过每个顶点UV分配空间上的UV映射进行优化的。

保形失真度量，只惩罚角失真，可以表示为紫外变量的二次函数[Desbrun等人，2002；Levy等人，2002]，导致稀疏最小平方问题，这是非常有效的解决。不幸的是，同样考虑面积的失真测量（例如[霍曼和格林纳2000；Liu等人2008；Sander等人2001])是非线性和非凸的，因此难以最小化。这引发了寻找好的算法和数字解决方案的研究。

在最成功的方法中，局部/全局优化[Liu et al. 2008]交替计算完美等距但不连续映射，并通过全局优化拼接创建连续但不再等距映射。我们的方法借鉴了富有成效的想法，分配每个角点变量给每个顶点，每个事件三角形一个，有效地分离UV空间中的每个三角形。

最近的研究制定了复杂的和高度非凸的目标函数，能够通过连续优化找到几乎等距和无可逆的参数化，通过最小化迭代更新的凸代理[Kovals基等人2016；拉宾维奇等人2017；史密斯和谢弗2015]。我们建议采取另一个飞跃，并在同一目标函数中包括切割优化和一个最先进的失真度量。这是微不足道的，因为削减优化和失真最小化有截然不同的行为：后者倾向于传播误差同样在表面，而前者必须集中误差在一个离散集（削减顶点），让它在零，由于切割的二进制性质。因此，直观地说，一个同时容纳切割和低失真的目标函数必须是非常非凸的。

## 2.2 优化切割
尽管对网格参数化进行了广泛的研究，但切割的自动计算仍然是一个开放的问题。许多参数化方法都接受切割作为输入，并计算具有一个或几个磁盘拓扑结构的曲面的映射。早期的方法也要求指定UV域中的切割形状（例如[Floater 2003]）。最近的自由边界方法优化了整个二维补丁的形状，包括边界（例如[Desbrun等2002；列维等2002；刘等2008；Sheffer等2005])。目前的工作成功地避免了局部和全局的自交，同时保持了边界自由和最小化等距失真测量[Smith和Schaefer 2015]。

在一些工作中，切被确定为参数化过程的一部分。它们可以大致被分为三个不同的组，具体情况如下。

为重新契合应用而削减。最近的大部分参数化文献倾向于关注四边形重划分的应用，而我们对纹理映射感兴趣。在重新划分网格的参数化中，切割放置在很大程度上是无关紧要的，只要UV空间中每一个切割的两边匹配，直到旋转π/2的整数倍和平移步骤。具有这种属性的切割有时被称为“可网格化”，因为它可以被网格无缝地穿越，然后参数化被称为“无缝化”。因此，在重新划分时，关于良好的放置位置的问题经常被忽视（例如，见[Bommes等人2009年]和调查[Bommes等人2013年]）。锥形奇点的放置，可以被理解为可网格切割的端点，仍然是至关重要的，并且可以作为单独优化的主题[Ben-Chen et al. 2008；Myles和Zorin 2013]。一些工作优化网格上可网格切割的位置（从锥开始），如直线或场对齐和短[凸边和工作带2014；Tarini等人2011]。奇点图的交互式设计[Takyama等人2013；Tong等人2006]也可以被视为规定可网格切割的一种特殊方式。不幸的是，在传统的纹理映射应用中，可网格切割不那么有用，并且施加了只必要的四边形网格情况下的不必要的约束。尽管它们可以为特定类型的纹理映射提供一定的好处[Ray et al. 2010]，但可网格切割并不是严格要求的，也很少使用，例如在游戏行业。一个关键的原因是，一般的切割，而不是可网格的切割，它的重要目的是用补丁内的高斯曲率来换取其边界上的线曲率，从而减少失真。这种考虑是基础。

增加切割，同时尽量减少失真。许多方法产生新的切割，作为对抗过度局部扭曲的手段。一种方法是在最小化失真能量和在失真超过某一阈值时贪婪地放置额外切割之间交替，见[Gu等2002；Sorkine等2002]。另一种方法是首先通过分析高斯曲率和可见性来确定良好的切割候选位置，见例如[Ben-Chen等人，2008；Sheffer和Hart，2002]。所有这些方法都试图平衡失真和切割作为同一迭代过程的一部分；然而，与我们的方法不同，切割的放置依赖于启发式，而不是直接成为映射的全局优化的一部分。

通过网格划分生成切割。在30多年的发展过程中，许多参数化方法将初始网格用磁盘拓扑划分为单独的补丁（即单独的连接组件），从而将切割定义为分区的边界。划分可以考虑各种不同的因素，例如根据特征聚集三角形[张等人2005]，法线[梅洛等1993]或可开发性标准[朱利叶斯等2005]，播种和扩展区域[列维等2002]，计算表面的中心镶嵌[博尔-马丁等2004]，简化网格并使用基础网格的多边形来定义图表[霍达科夫斯基等2003]，跟踪交叉场后的切割[驼峰和背带2014]，或遵守曲面的弯曲骨架[Usai等人。2015]（这个列表中的每个项目都有一个引用）。虽然这些方法背后的选择都是受到关于其对最终参数化质量的影响的有效的、一般的考虑的启发，但先验假设是间接的，不能期望导致最优的UV图。通常，这些补丁往往比理想的补丁更小、更多。另一个限制是，通过构造，切割只能出现在属于不同补丁的元素之间。这就施加了一个人工约束，这在许多良好的剪切布局中经常被违反，例如典型的人工设计的布局，其中剪切也可以自由地出现在属于同一补丁的多边形之间。

绕过了削减开支的需要。纹理映射研究的长期趋势努力绕过而不是解决识别良好切割的任务[塔里尼等人2017]，通过提供完全替代二维参数化和二维纹理映射[本森和戴维斯2002；伯利和拉斯韦尔2008；克里斯坦森和巴塔利2004；2006年列斐伏尔和霍普2006；塔里尼等人2004年；尤克塞尔等人2010年]，或使他们的定位不那么重要甚至无关紧要[列费伏尔和达赫斯巴赫2007；普诺莫等人2004；雷等人2010年；塔里尼2012,2016]。所有这些方法都提供了新的视角和权衡。与此同时，该行业几乎一致支持传统的紫外线和纹理贴图，可能是因为它们提供的好处，目前没有任何替代方案与之完全匹配。除了熟悉，这些包括内容创建方面：通用性、完整的适应性，富有成效的类比纹理和传统的2D图像（利用各种方式，如直接绘画2D纹理），和渲染方面：简单、时间效率和资源，最重要的友好，应用过滤器和预过滤（MIP映射）。基于所有这些原因，我们认为，在UV映射中定义良好的切割的问题仍然是高度相关的。

现有的手动切割放置工具。在图形相关的行业，产生UV映射的任务总是计算机辅助而不是全自动的；失真最小化成功地委托给自动算法，而切割的放置通常需要训练有素的数字艺术家手动干预。所有现代建模包都提供了专门的接口和复杂的交互工具，但该任务仍然很耗时（参见随附的视频）。如果输入网格是不规则的，那么由于UV映射器不能快速选择连续的边（即所谓的边循环）作为切割，难度就会增加。我们的方法提供了一个改进，因为它消除了完全手动切割选择的必要性，并且不依赖于网格连接的规律性。

3. UV优化方法
UV映射的一个目标是参数化一个具有最小的失真和最小的切割长度的网格。一个极端是做必要的最小切割来诱导磁盘拓扑，这导致高度扭曲的三角形对纹理映射应用程序无用，而另一个极端是在所有内部边缘上放置切割，这样每个三角形的映射没有任何扭曲[Burley和Lacewell 2008]。在这项工作中，我们提出了一种交互式地探索求解空间的方法。

在我们的公式中，我们将原始网格视为一个三角形汤，其中每个三角形都与其他三角形分开。每个内边都被复制，并在三角形汤中出现为两个副本。每个顶点根据其度复制多次，副本称为角。我们用$v_i、e_j、f_k$来表示原始网格的顶点、边和面，并使用下标$i、j、k$来指代与顶点、边和面相关的量。例如，$a_k$是面片的面积, $l_j$是边$e_j$的长度。我们使用混合下标来识别三角形汤中的边副本和角。比如，$e_{jk}$指和面$f_k$相关的边$e_j$的副本，$v_{ik}$指源于$v_i$并且在面$f_k$中的角顶点。我们优化的变量是UV空间中的角的位置，表示为$X$ = {$x_{ik}$ = （$U_{ik}$ ，$V_{ik})$} 。最后，我们使用$f_k (X)$来引用所有与$f_k$相关的变量，也就是面$f_k$的三个角UVs $x_{ik}$。（类似的还有$e_j(X),e_{jk}(X)$等等）
![图2](./illustration/p2.png)

三角形汤的参数化是指每个三角形到该平面的映射。当一条边的两个副本被分开且不完全重合时，就会发生切割。在最广泛的意义上，我们的方法包括解决以下优化问题：
$\mathop{min}\limits_{X} E(X) = min (1-\lambda)D(X)+\lambda S(X)$
其中E为总目标函数，D为失真目标（如保留角度或面积），S为分离目标，参数λ控制两个目标之间的平衡（图2）。这两个目标分别被定义为对面和边的加权和：
$D(X) = \sum\limits_{face\,k} A_k E_d (f_k(X))$,
$S(X) = \sum\limits_{edge\,j} l_j E_s (e_j(X))$,

其中$E_d$为三角形失真度，$E_s$为边缘分离度。而失真措施在以前的工作中已经被彻底讨论过(小节2)、与分离措施相关的相关工作较少。确定一个适当的这种措施是这项工作的主要挑战之一。我们接下来讨论我们的选择，并简要地讨论失真措施。

分离措施。给定一个位于UV空间的边缘的两个副本，我们的目标是找到一个有意义的测量它们的分离。在不连续伽辽金方法领域也讨论了一个类似的问题[Cockburn et al. 2000],使用不符合（即不连续）有限元素。Babuska和Zlamal [1973]提出测量沿边缘跳跃的L2范数。一种更现代的方法使用数值通量的概念，它通常被定义为平均的积分和关于边的函数的差的组合[Arnold et al. 2001]。最近，另一种分离方法出现在[Fu和Liu 2016]中，用于计算双射映射。这种度量称为边装配约束，本质上是两个边向量之间差的范数。

在我们的设置中，我们观察到，当考虑切割时，一条边可以有三种不同状态中的一种：它可以未切割，半切割（其中一个端点顶点分裂，而另一个没有），也可以完全切割（见插图）。上述措施不能区分完全切割状态和半切割状态。相反，我们建议独立地考虑每个边端点上的每一对角。也就是说，分离度量包括两对端点之间的距离。更准确地说，让$f_{k1}$和fk2是两个与两个端点$v_i$，$v_i$.共享一个边ej的面我们定义了一个应用于两对$v_{ij}(X)$和$v_{i'j}(X)$的角分离测度，即，在ej的端点上的两对角：